#!/bin/bash
set -e  # Exit on error
version="0.6.5"
deb_pkg_name="miru"

miru_binaries_dir="/usr/local/miru"

agent_bin_name="miru-$version"
agent_bin_path="$miru_binaries_dir/$agent_bin_name"
agent_bin_symlink_name="miru"
agent_bin_symlink_path="$miru_binaries_dir/$agent_bin_symlink_name"
agent_start_script_name="miru-start.sh"

install_bin_name="install-miru"
install_bin_path="$miru_binaries_dir/$install_bin_name"

systemd_dir="/etc/systemd/system"
systemd_service_name="miru.service"
systemd_service_path="$systemd_dir/$systemd_service_name"

miru_dir="/var/lib/miru"
miru_log_dir="/var/log/miru"

# Create a symlink to the miru agent binary
ln -s $agent_bin_path $agent_bin_symlink_path

# Clear the terminal and display the installation message
echo -e "\033[2J\033[H================="
echo "Miru Installation"
echo "================="
echo ""

# Ensure the script is running with elevated privileges
if [ "$(id -u)" -ne 0 ]; then
  echo "ERROR: miru installation script must be run with sudo"
  exit 1
fi

# Add miru to the PATH temporarily
export path="$path:$install_bin_path"

# Give miru installation instructions
echo "To complete the Miru installation run: sudo $install_bin_path"
echo ""

# Exit successfully
exit 0