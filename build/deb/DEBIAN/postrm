#!/bin/bash
set -e  # Exit on error
version="0.6.5"
deb_pkg_name="miru"

miru_binaries_dir="/usr/local/miru"

agent_bin_name="miru-$version"
agent_bin_path="$miru_binaries_dir/$agent_bin_name"
agent_bin_symlink_name="miru"
agent_bin_symlink_path="$miru_binaries_dir/$agent_bin_symlink_name"
agent_start_script_name="miru-start.sh"

install_bin_name="install-miru"
install_bin_path="$miru_binaries_dir/$install_bin_name"

systemd_dir="/etc/systemd/system"
systemd_service_name="miru.service"
systemd_service_path="$systemd_dir/$systemd_service_name"

miru_dir="/var/lib/miru"
miru_log_dir="/var/log/miru"

# Variables
script="postrm"

# Ensure the script is running with elevated privileges
if [ "$(id -u)" -ne 0 ]; then
  echo "'$script' script must be run as the root user"
  exit 1
fi

# Remove the symlink to the miru agent binary
if [ -L "$agent_bin_symlink_path" ]; then
    rm -f "$agent_bin_symlink_path"
fi

# Remove any binaries from a previous installation
if [ -d "$miru_binaries_dir" ]; then
    rm -rf "$miru_binaries_dir"
fi

# Remove any previous installation data
if [ -d "$miru_dir" ]; then
    rm -rf "$miru_dir"
fi

# Remove any previous log data
if [ -d "$miru_log_dir" ]; then
    rm -rf "$miru_log_dir"
fi

# Remove the service file if it exists
if [ -f "$systemd_service_path" ]; then
    rm -f "$systemd_service_path"
fi

exit 0